{% extends "base.html" %}
{% block title %}ì´ë ¥ - ë¡œë˜ ë¶„ì„{% endblock %}
{% block content %}
<div class="page-header">
    <h1>ğŸ“‹ ì…ë ¥ ì´ë ¥</h1>
    <p>ë“±ë¡ëœ ëª¨ë“  íšŒì°¨ì™€ ì˜ˆì¸¡ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤</p>
</div>

{% if not rounds %}
<div class="empty-state">
    <i class="fas fa-inbox"></i>
    <h3>ë“±ë¡ëœ íšŒì°¨ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p><a href="/input" style="color:var(--accent-gold)">ì…ë ¥ í˜ì´ì§€</a>ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</p>
</div>
{% else %}
<div class="card">
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>íšŒì°¨</th>
                    <th>ì¶”ì²¨ì¼</th>
                    <th>ë‹¹ì²¨ ë²ˆí˜¸</th>
                    <th>ë“±ë¡ëœ ì½”ë“œ</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody>
                {% for r in rounds %}
                <tr id="row-{{ r.round_number }}">
                    <td><strong style="font-family:'JetBrains Mono'">{{ r.round_number }}</strong>íšŒ</td>
                    <td style="color:var(--text-muted);font-size:0.85rem">{{ r.draw_date or '-' }}</td>
                    <td>
                        {% for i in range(1,7) %}
                        {% set n = r['num' ~ i] %}
                        <span class="lotto-ball {% if n <= 10 %}z1{% elif n <= 20 %}z2{% elif n <= 30 %}z3{% elif n <= 40 %}z4{% else %}z5{% endif %}" style="width:28px;height:28px;font-size:0.72rem">{{ n }}</span>
                        {% endfor %}
                    </td>
                    <td id="codes-{{ r.round_number }}">
                        <span style="color:var(--text-muted);font-size:0.82rem">ë¡œë”©...</span>
                    </td>
                    <td>
                        <div style="display:flex;gap:0.4rem">
                            <a href="/round/{{ r.round_number }}" class="btn btn-outline btn-sm">
                                <i class="fas fa-chart-bar"></i> ë¶„ì„
                            </a>
                            <form action="/round/{{ r.round_number }}/delete" method="POST"
                                  onsubmit="return confirm('{{ r.round_number }}íšŒì°¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
const CODES = {
    {% for cid, c in codes.items() %}
    '{{ cid }}': {short:'{{ c.short }}', color:'{{ c.color }}'},
    {% endfor %}
};

// ê° íšŒì°¨ì˜ ë“±ë¡ ìƒíƒœ ì¡°íšŒ
document.querySelectorAll('[id^="codes-"]').forEach(async el => {
    const rn = el.id.replace('codes-', '');
    try {
        const res = await fetch(`/api/round/${rn}/status`);
        const data = await res.json();
        if (!data.exists) return;
        let html = '';
        for (const [cid, info] of Object.entries(CODES)) {
            const s = data.codes[cid];
            if (s && s.entered) {
                html += `<span style="display:inline-block;padding:2px 6px;border-radius:4px;font-size:0.7rem;font-family:'JetBrains Mono';font-weight:600;background:${info.color}20;color:${info.color};border:1px solid ${info.color}40;margin:1px">${info.short}</span>`;
            }
        }
        el.innerHTML = html || '<span style="color:var(--text-muted);font-size:0.8rem">ë¯¸ì…ë ¥</span>';
    } catch(e) {}
});
</script>
{% endblock %}
