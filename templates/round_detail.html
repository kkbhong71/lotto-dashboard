{% extends "base.html" %}
{% block title %}{{ round_number }}회차 분석{% endblock %}
{% block content %}
<div class="page-header">
    <div style="display:flex;align-items:center;gap:1rem">
        <a href="/history" class="btn btn-outline btn-sm"><i class="fas fa-arrow-left"></i></a>
        <div>
            <h1>{{ round_number }}회차 상세 분석</h1>
            <p>각 코드의 예측 결과와 실제 당첨 번호 비교</p>
        </div>
    </div>
</div>

<!-- 당첨 번호 표시 -->
<div class="card" style="margin-bottom:1.5rem;text-align:center">
    <div class="card-title" style="justify-content:center"><i class="fas fa-trophy"></i> 당첨 번호</div>
    <div style="display:flex;justify-content:center;gap:0.75rem;flex-wrap:wrap">
        {% for n in analysis.actual %}
        <span class="lotto-ball {% if n <= 10 %}z1{% elif n <= 20 %}z2{% elif n <= 30 %}z3{% elif n <= 40 %}z4{% else %}z5{% endif %}" style="width:48px;height:48px;font-size:1.1rem">
            {{ n }}
        </span>
        {% endfor %}
    </div>
</div>

<!-- 코드별 결과 -->
{% for code_id, result in analysis.codes.items() %}
<div class="card" style="margin-bottom:1rem">
    <div class="card-title">
        <span class="code-dot" style="background:{{ result.color }}"></span>
        {{ code_id }} {{ result.name }}
        <span style="margin-left:auto;font-family:'JetBrains Mono';font-size:0.9rem">
            최대
            <span style="color:{% if result.max_match >= 4 %}var(--accent-gold){% elif result.max_match >= 3 %}var(--accent-green){% else %}var(--text-secondary){% endif %};font-weight:700;font-size:1.1rem">
                {{ result.max_match }}
            </span>개 일치
        </span>
    </div>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:0.5rem">
        {% for s in result.sets %}
        <div style="display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0.75rem;border-radius:10px;background:{% if s.is_best and s.match_count >= 3 %}rgba(240,180,41,0.08){% else %}var(--bg-secondary){% endif %};border:1px solid {% if s.is_best and s.match_count >= 3 %}rgba(240,180,41,0.3){% else %}transparent{% endif %}">
            <span style="color:var(--text-muted);font-family:'JetBrains Mono';font-size:0.72rem;width:20px">{{ loop.index }}</span>
            {% for n in s.numbers %}
            <span class="lotto-ball {% if n <= 10 %}z1{% elif n <= 20 %}z2{% elif n <= 30 %}z3{% elif n <= 40 %}z4{% else %}z5{% endif %} {% if n in s.hit_numbers %}hit{% endif %}" style="width:28px;height:28px;font-size:0.72rem{% if n not in s.hit_numbers %};opacity:0.4{% endif %}">
                {{ n }}
            </span>
            {% endfor %}
            <span style="margin-left:auto;font-family:'JetBrains Mono';font-size:0.78rem;color:{% if s.match_count >= 4 %}var(--accent-gold){% elif s.match_count >= 3 %}var(--accent-green){% elif s.match_count >= 2 %}var(--text-secondary){% else %}var(--text-muted){% endif %}">
                {{ s.match_count }}개
            </span>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}

{% if not analysis.codes %}
<div class="empty-state">
    <i class="fas fa-clipboard-list"></i>
    <h3>등록된 예측이 없습니다</h3>
    <p><a href="/input" style="color:var(--accent-gold)">입력 페이지</a>에서 예측 번호를 입력하세요</p>
</div>
{% endif %}
{% endblock %}
